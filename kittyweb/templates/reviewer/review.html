{% extends "base.html" %}
{% block title %}Review â€” KittyPottySpy{% endblock %}
{% block nav_review_active %}active{% endblock %}

{% block content %}
  <div class="pager">
    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    <span class="spacer">|</span>
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}&page_size={{ page_obj.paginator.per_page }}">Prev</a>
    {% endif %}
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&page_size={{ page_obj.paginator.per_page }}">Next</a>
    {% endif %}
  </div>

  <div class="grid">
    {% for item in page_obj.object_list %}
      <div class="card">
        <div class="row">
          <img class="thumb" src="/media/crops/{{ item.crop_filename }}" alt="crop">
          {% if item.frame_filename %}
            <img class="thumb" src="/media/frames_labeled/{{ item.frame_filename }}" alt="frame">
          {% endif %}
        </div>

        <div class="meta">
          <div>Crop: {{ item.crop_filename }}</div>
          <div>Predicted: <span class="pred">{{ item.predicted_label }}</span>{% if item.distance_value %} (d={{ item.distance_value }}){% endif %}</div>
          {% if item.frame_filename %}<div>Frame: {{ item.frame_filename }}</div>{% endif %}
        </div>

        <form method="post" action="/act/">
          {% csrf_token %}
          <input type="hidden" name="crop_filename" value="{{ item.crop_filename }}">
          <input type="hidden" name="predicted" value="{{ item.predicted_label }}">
          <input type="hidden" name="distance_value" value="{{ item.distance_value }}">
          <button class="btn" name="action" value="approve">Approve</button>
          <button class="btn" name="action" value="unknown">Unknown</button>
          <span>Override to:</span>
          <input type="text" name="override_label" placeholder="CatName">
          <button class="btn" name="action" value="override">Save</button>
        </form>
      </div>
    {% empty %}
      <p>No predictions found yet. Run identification or wait for new crops.</p>
    {% endfor %}
  </div>

  <div class="pager" style="margin-top:16px">
    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    <span class="spacer">|</span>
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}&page_size={{ page_obj.paginator.per_page }}">Prev</a>
    {% endif %}
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&page_size={{ page_obj.paginator.per_page }}">Next</a>
    {% endif %}
  </div>
{% endblock %}